from supabaseClient import supabase

def return_status_id(status_value):
    response = supabase.table("statuses").select("id").eq("value", status_value).execute()
    if response.data:
        print("Status ID:", response.data[0]['id'])
        return response.data[0]['id']
    else:
        return None

def return_device_type_id(type_value):
    response = supabase.table("device_types").select("id").eq("name", type_value).execute()
    if response.data:
        print("Device Type ID:", response.data[0]['id'])
        return response.data[0]['id']
    else:
        return None

def return_customer_id(customer_name):
    response = supabase.table("customers").select("id").eq("customer_name", customer_name).execute()
    if response.data:
        print("Customer ID:", response.data[0]['id'])
        return response.data[0]['id']
    else:
        return None

def search_assets(search_dict):
    search_dict=dict(search_dict)
    if search_dict['status_id']:
        search_dict['status_id'] = return_status_id(search_dict['status_id'])
    if search_dict['type_id']:
        search_dict['type_id'] = return_device_type_id(search_dict['type_id'])
    if search_dict['customer_id']:
        search_dict['customer_id'] = return_customer_id(search_dict['customer_id'])
    search_array=[]
    for item in search_dict:
        if search_dict[item]:
            search_array.append(item)
    if len(search_array) == 0:
        response = supabase.table("devices").select("hostname, device_types(name), statuses(value), customers(customer_name)").execute()
    elif len(search_array) == 1:
        response = supabase.table("devices").select("hostname, device_types(name), statuses(value), customers(customer_name)").eq(search_array[0], search_dict[search_array[0]]).execute()
        print(response)
    elif len(search_array) == 2:
        response = supabase.table("devices").select("hostname, device_types(name), statuses(value), customers(customer_name)").eq(search_array[0], search_dict[search_array[0]]).eq(search_array[1], search_dict[search_array[1]]).execute()
        print(response)
    elif len(search_array) == 3:
        response = supabase.table("devices").select("hostname, device_types(name), statuses(value), customers(customer_name)").eq(search_array[0], search_dict[search_array[0]]).eq(search_array[1], search_dict[search_array[1]]).eq(search_array[2], search_dict[search_array[2]]).execute()
        print(response)
    return response.data if response.data else None

 